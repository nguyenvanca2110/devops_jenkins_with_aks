=================== Azure ========================
# Login to Azure

az login


=================== Azure AKS ========================

#  Get the credentials of AKS in local to mange the Cluster 
az aks get-credentials --resource-group=<RGNAME> --name=<AKSCLUSTERNAME>

az aks get-credentials --resource-group=canv-aks --name=canv-aks-demo

kubectl get all --all-namespaces

# List all pods in ps output format
kubectl get pods

# List all pods in ps output format with more information (such as node name)
kubectl get pods -o wide

kubectl get nodes

=================== Azure ACR ========================

# List repositories in a given Azure Container Registry.
# az acr repository list --name MyRegistry
az acr repository list --name lsepocnodejs

# List container registries in a resource group and show the results in a table.
az acr list --resource-group canv-aks --output table

# List repositories in an Azure Container Registry. (autogenerated)
# az acr repository list --name MyRegistry --resource-group myresourcegroup
az acr repository list --name lsepocnodejs --resource-group canv-aks

# Import the image from the registries to AKS 
az acr import –name canv-app –source mcr.microsoft.com/azuredocs/azure-vote-front:v2 –image azure-vote-front:v2

=================== DOCKER ========================
# login to ACR Registries for push image
docker login <REGISTRY_NAME>.azurecr.io -u <appId> -p <password>

docker login canvnodejsapp.azurecr.io -u $POC_ACR_CREDENTIALS_USR -p $POC_ACR_CREDENTIALS_PSW

# Push image to ACR:
docker push canvnodejsapp.azurecr.io/nodeapp_app:2022.12.12_14.58.41

================================================
# Store credential for AKS, the secret 'lsepocnodejs-secret' will be used to pull the image
# Because we can have multiple Registries
 
kubectl create secret docker-registry <secret-name> --namespace <namespace> --docker-server=<REGISTRY_NAME>.azurecr.io --docker-username=<appId> --docker-password=<password>
 
kubectl create secret docker-registry lsepocnodejs-secret --namespace canv-aks-demo9138 --docker-server canvnodejsapp.azurecr.io --docker-username=$POC_ACR_CREDENTIALS_USR --docker-password=$POC_ACR_CREDENTIALS_PSW

 

# ======= Deploy to AKS and Test

# make 
kubectl apply -f kube-manifests/

# List Pods
kubectl get pods

# Describe Pod
kubectl describe pod <pod-name>

# Get Load Balancer IP
kubectl get svc

# Access Application
http://<External-IP-from-get-service-output>

















# =====================================================================================
 # Export Command
export ACR_REGISTRY=canvnodejsapp.azurecr.io
export ACR_NAMESPACE=canv-aks-demo9138
export ACR_IMAGE_NAME=kube-nginx-acr
export ACR_IMAGE_TAG=v1
echo $ACR_REGISTRY, $ACR_NAMESPACE, $ACR_IMAGE_NAME, $ACR_IMAGE_TAG

# Login to ACR
docker login $ACR_REGISTRY


=== Configure ACR integration for existing AKS clusters¶

#Set ACR NAME
export ACR_NAME=canv-aks-demo9138
echo $ACR_NAME

# Template
az aks update -n myAKSCluster -g myResourceGroup --attach-acr <acr-name>

# Replace Cluster, Resource Group and ACR Repo Name
az aks update -n aksdemo2 -g aks-rg2 --attach-acr $ACR_NAME



===================== Azure AKS Credential ===========